name: xsmind
recipe: drupal9
config:
  webroot: .
  drush: ^11
  xdebug: true
  php: '8.1'
  conf:
    php: lando/php.ini
services:
  appserver:
    xdebug: true
    overrides:
      environment:
        XDEBUG_MODE: debug
        PHP_IDE_CONFIG: serverName=xsmind.lndo.site
        LANDO_HOST_IP: host.docker.internal
        XDEBUG_CONFIG: remote_enable=1 remote_host=host.docker.internal
    config:
      php: lando/php.ini
  phpmyadmin:
    type: phpmyadmin
  database:
    run_as_root:
      - >-
        mysql -uroot -e "GRANT SUPER ON *.* to 'drupal9'@'%' IDENTIFIED by
        'drupal9';"
tooling:
  build-site:
    service:
      appserver: null
    description: Rebuild Xsmind App
    cmd:
      - appserver: ./scripts/site-build.sh
  drush:
    service: appserver  
    cmd: php /app/vendor/drush/drush/drush    
  xdebug-on:
    service: appserver
    description: Enable Xdebug.
    user: root
    cmd:
      - >-
        docker-php-ext-enable xdebug && kill -USR2 $(pgrep -o php-fpm) >
        /dev/null || /etc/init.d/apache2 reload
      - tput setaf 2 && echo "Xdebug On" && tput sgr 0 && echo
  xdebug-off:
    service: appserver
    description: Disable Xdebug.
    user: root
    cmd:
      - >-
        rm /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini && kill -USR2
        $(pgrep -o php-fpm) > /dev/null || /etc/init.d/apache2 reload
      - tput setaf 1 && echo "Xdebug Off" && tput sgr 0 && echo
